<div class="dashboard">
  <div class="dashboard-header">
    <h1>My Tasks</h1>
    <div class="dashboard-actions">
      <a href="/tasks/new" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add Task
      </a>
      <div class="export-dropdown">
        <button class="btn btn-secondary dropdown-toggle">
          <i class="fas fa-download"></i> Export
        </button>
        <div class="dropdown-menu">
          <a href="/tasks/export/csv" class="dropdown-item">Export as CSV</a>
          <a href="/tasks/export/pdf" class="dropdown-item">Export as PDF</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Progress Bar -->
  <div class="progress-section">
    <h3>Progress Overview</h3>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill" style="width: <%= progress %>%"></div>
    </div>
    <p class="progress-text"><%= progress %>% Complete</p>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <form action="/tasks" method="GET" class="filters-form">
      <div class="filter-group">
        <input type="text" name="search" placeholder="Search tasks..." value="<%= search %>" class="search-input">
      </div>
      <div class="filter-group">
        <select name="category" class="filter-select">
          <option value="all" <%= category === 'all' ? 'selected' : '' %>>All Categories</option>
          <option value="Work" <%= category === 'Work' ? 'selected' : '' %>>Work</option>
          <option value="Personal" <%= category === 'Personal' ? 'selected' : '' %>>Personal</option>
          <option value="Shopping" <%= category === 'Shopping' ? 'selected' : '' %>>Shopping</option>
          <option value="Health" <%= category === 'Health' ? 'selected' : '' %>>Health</option>
          <option value="Education" <%= category === 'Education' ? 'selected' : '' %>>Education</option>
          <option value="Other" <%= category === 'Other' ? 'selected' : '' %>>Other</option>
        </select>
      </div>
      <div class="filter-group">
        <select name="priority" class="filter-select">
          <option value="all" <%= priority === 'all' ? 'selected' : '' %>>All Priorities</option>
          <option value="High" <%= priority === 'High' ? 'selected' : '' %>>High</option>
          <option value="Medium" <%= priority === 'Medium' ? 'selected' : '' %>>Medium</option>
          <option value="Low" <%= priority === 'Low' ? 'selected' : '' %>>Low</option>
        </select>
      </div>
      <div class="filter-group">
        <select name="completed" class="filter-select">
          <option value="all" <%= completed === 'all' ? 'selected' : '' %>>All Status</option>
          <option value="false" <%= completed === 'false' ? 'selected' : '' %>>Pending</option>
          <option value="true" <%= completed === 'true' ? 'selected' : '' %>>Completed</option>
        </select>
      </div>
      <button type="submit" class="btn btn-secondary">Filter</button>
    </form>
  </div>

  <!-- Task List -->
  <div class="task-list" id="taskList">
    <% if (tasks.length === 0) { %>
      <div class="empty-state">
        <i class="fas fa-clipboard-list"></i>
        <h3>No tasks found</h3>
        <p>Get started by adding your first task!</p>
        <a href="/tasks/new" class="btn btn-primary">Add Your First Task</a>
      </div>
    <% } else { %>
      <% tasks.forEach(task => { %>
        <div class="task-card <%= task.completed ? 'completed' : '' %>" data-id="<%= task._id %>">
          <div class="task-header">
            <div class="task-checkbox">
              <input type="checkbox" <%= task.completed ? 'checked' : '' %>
                     onchange="toggleTask('<%= task._id %>', this.checked)">
            </div>
            <h3 class="task-title <%= task.completed ? 'strikethrough' : '' %>"><%= task.title %></h3>
            <div class="task-actions">
              <a href="/tasks/<%= task._id %>/edit" class="btn btn-sm btn-secondary">
                <i class="fas fa-edit"></i>
              </a>
              <form action="/tasks/<%= task._id %>?_method=DELETE" method="POST" style="display: inline;"
                    onsubmit="return confirm('Are you sure you want to delete this task?')">
                <button type="submit" class="btn btn-sm btn-danger">
                  <i class="fas fa-trash"></i>
                </button>
              </form>
            </div>
          </div>
          <% if (task.description) { %>
            <p class="task-description"><%= task.description %></p>
          <% } %>
          <div class="task-meta">
            <span class="task-category category-<%= task.category.toLowerCase() %>">
              <i class="fas fa-tag"></i> <%= task.category %>
            </span>
            <span class="task-priority priority-<%= task.priority.toLowerCase() %>">
              <i class="fas fa-flag"></i> <%= task.priority %>
            </span>
            <% if (task.dueDate) { %>
              <span class="task-due-date <%= new Date(task.dueDate) < new Date() && !task.completed ? 'overdue' : '' %>">
                <i class="fas fa-calendar"></i>
                <%= new Date(task.dueDate).toLocaleDateString() %>
              </span>
            <% } %>
          </div>
        </div>
      <% }) %>
    <% } %>
  </div>
</div>
